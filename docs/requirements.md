MIRAI - 要件定義書

## 要件定義の作成原則
- **「あったらいいな」は絶対に作らない**
- **拡張可能性のための余分な要素は一切追加しない**
- **将来の「もしかして」のための準備は禁止**
- **今、ここで必要な最小限の要素のみ**

---

## 1. プロジェクト概要

### 1.1 成果目標
入管庁API連携により在留資格申請を完全電子化し、外国人・企業・支援機関・士業の4者が利用する日本市場No.1の在留管理SaaSプラットフォームを構築、rakuvisaの全87機能を完全実装しAI/自動化で差別化、4ヶ月で正式ローンチを実現する。

### 1.2 成功指標

#### 定量的指標
- **開発期間**: 4ヶ月でフルローンチ完了
- **実装機能数**: 全87機能（rakuvisa完全同等）
- **AI精度**: 承認予測80%以上（初期ローンチ時）、90%以上（運用6ヶ月後）
- **申請処理時間**: rakuvisa対比40%削減
- **ページ表示速度**: 2秒以内（平均）
- **システム稼働率**: 99.9%以上（年間）
- **Year 1目標**: 登録ユーザー1,000人、MRR ¥1M、月間申請処理500件

#### 定性的指標
- **法令遵守**: 入管法・行政書士法100%準拠
- **技術的優位性**: rakuvisa対比で全指標優位（AI、自動化、UX）
- **ユーザー体験**: 誰でも簡単に在留資格申請ができる
- **セキュリティ**: ISO 27001準拠レベルのセキュリティ確保
- **多言語対応**: 11言語完全対応で言語の壁を排除

---

## 2. システム全体像

### 2.1 主要機能一覧

#### ①外国人向け機能（15カテゴリ）
- **在留カード管理**: デジタル管理、GPASS連携、マイナンバーカード対応、所属組織管理
- **ビザ申請サポート**: 入管API直接連携、電子署名、AI予測、全29在留資格対応、行政書士確認・代行
- **多言語対応**: 11言語対応（日本語、英語、中国語簡体字・繁体字、ベトナム語、インドネシア語、ネパール語、タイ語、ミャンマー語、タガログ語、クメール語）
- **書類提出・アップロード**: 完全オンライン書類管理、自動保存、写真補正
- **通知・リマインダー**: 緊急申請通知、期限管理アラート、申請進捗通知
- **企業コミュニケーション**: 多者間連携、進捗透明性、チャット、リアルタイム進捗共有
- **マイページ**: 申請進捗可視化ダッシュボード、オンライン申請管理、書類管理、詳細ガイド
- **証明書ダウンロード**: PDF書類ダウンロード、オンライン完結
- **FAQ・サポート**: FAQ専用サイト、チャットサポート、専門家相談、多言語サポート
- **特定技能特別機能**: 定期提出書類クラウド作成、オンライン面談、支援計画書作成

#### ②企業向け機能（12カテゴリ）
- **従業員データベース管理**: 外国人従業員の一元管理
- **在留期限AI予測アラート**: 更新時期の自動通知
- **書類テンプレート管理**: 雇用契約書、条件書の自動生成
- **雇用契約書自動翻訳**: 多言語自動翻訳
- **登録支援機関連携**: 支援機関とのデータ共有
- **ダッシュボード・分析**: 従業員ビザ状況の可視化

#### ③登録支援機関向け機能（12カテゴリ）
- **支援計画作成**: 2025年4月改正対応
- **定期面談オンライン実施**: ビデオ通話機能
- **AI書き起こし・要約**: Whisper APIによる自動文字起こし
- **四半期報告書自動作成**: 様式第5-5号等の自動生成
- **年次報告書自動作成**: 入管提出書類の自動生成
- **支援対象者管理**: 特定技能外国人の一元管理

#### ④行政書士・弁護士向け機能（15カテゴリ）
- **顧客管理**: 企業・個人顧客のCRM
- **87申請類型完全対応**: 全ての在留資格手続きに対応
- **AI申請書類最適化**: GPT-4による申請書類の最適化
- **AI理由書生成**: Claude 3.5による理由書の自動生成
- **電子署名ワークフロー**: 法的に有効な電子署名
- **従量課金システム**: ¥1,500/件の自動課金
- **案件進捗管理**: 複数案件の一元管理

#### ⑤管理者向け機能（8カテゴリ）
- **マルチレベル管理**: システム/事務所/企業/支援機関の階層管理
- **RBAC管理**: 9ロールの権限管理
- **利用状況分析**: ユーザー行動分析、収益分析
- **自動法令アップデート**: 法改正への自動対応
- **監査ログ**: 全操作の記録と追跡
- **セキュリティ管理**: アクセス制御、脅威検知

### 2.2 ユーザーロールと権限

#### 9つのユーザーロール
1. **ADMIN**: システム管理者（全権限）
2. **FIRM_ADMIN**: 行政書士事務所管理者（事務所内全権限）
3. **SCRIVENER**: 行政書士（申請代行、電子署名）
4. **FIRM_STAFF**: 行政書士事務所スタッフ（補助業務）
5. **COMPANY_ADMIN**: 企業管理者（企業内全権限）
6. **COMPANY_STAFF**: 企業スタッフ（従業員管理）
7. **SUPPORT_ORG_ADMIN**: 登録支援機関管理者（支援機関内全権限）
8. **SUPPORT_ORG_STAFF**: 登録支援機関スタッフ（支援業務）
9. **FOREIGN_NATIONAL**: 外国人本人（自己申請）

#### 権限マトリックス

| 機能/ページ | 外国人 | 企業 | 支援機関 | 行政書士 | 管理者 |
|------------|--------|------|---------|---------|--------|
| 在留カード管理 | ○ | △ | △ | ○ | ○ |
| ビザ申請 | ○ | × | × | ○ | ○ |
| 従業員管理 | × | ○ | △ | ○ | ○ |
| 支援計画書 | × | △ | ○ | ○ | ○ |
| 電子署名 | × | × | × | ○ | ○ |
| システム設定 | × | × | × | × | ○ |

凡例: ○=フルアクセス、△=一部制限、×=アクセス不可

### 2.3 認証・認可要件

#### 認証方式
- **基本認証**: メール + パスワード（NextAuth.js v5）
- **マイナンバーカード認証**: セルフプラン利用者向け
- **OAuth 2.0**: 将来的な拡張用（Google、Microsoft等）
- **二要素認証**: 行政書士、管理者は必須

#### セキュリティレベル
- **個人情報**: 氏名、国籍、在留カード番号、生年月日等
- **機密情報**: 雇用契約書、支援計画書、申請理由書
- **決済情報**: Stripe経由のクレジットカード処理
- **電子署名**: 行政書士の電子証明書を使用

#### 管理機能
- **必要性**: 必須（マルチテナント、RBAC、法令自動更新、監査ログ）
- **具体的な機能**:
  - ユーザー管理（登録、権限変更、停止）
  - テナント管理（事務所、企業、支援機関の登録）
  - 法令アップデート管理（入管法改正への対応）
  - システム設定（料金、メール通知、API設定）
  - 監査ログ閲覧（全操作の追跡）

---

## 3. ページ詳細仕様

### 3.1 P-001: トップページ（ランディングページ）

#### 目的
MIRAIの価値提案を明確に伝え、4つのユーザータイプごとに適切なCTAへ誘導する。

#### 主要機能
- サービス概要の表示（rakuvisa完全同等 + AI差別化）
- 4ユーザータイプ別のCTA（外国人、企業、登録支援機関、行政書士）
- 料金プラン比較表
- 11言語切り替え機能

#### 必要な操作
| 操作種別 | 操作内容 | 必要な入力 | 期待される出力 |
|---------|---------|-----------|---------------|
| 取得 | ページコンテンツ取得 | 言語パラメータ | 多言語対応コンテンツ |
| 遷移 | ユーザータイプ別登録 | ユーザータイプ選択 | 登録ページへ遷移 |

#### 処理フロー
1. ユーザーがページにアクセス
2. ブラウザ言語設定を検知し、適切な言語で表示
3. ユーザータイプを選択してCTAをクリック
4. 該当する登録ページへ遷移

#### データ構造（概念）
```yaml
LandingPageContent:
  識別子: 言語コード（ja, en, zh-CN, etc.）
  基本情報:
    - ヒーローセクション（必須）
    - 機能紹介セクション（必須）
    - 料金プランセクション（必須）
    - CTAセクション（必須）
  メタ情報:
    - 最終更新日時
  関連:
    - UserType（1対多）
```

### 3.2 U-001: ユーザー登録ページ

#### 目的
4つのユーザータイプごとに適切な情報を収集し、アカウントを作成する。

#### 主要機能
- ユーザータイプ別登録フォーム
- メールアドレス認証
- パスワード設定（8文字以上、英数字混在）
- 利用規約・プライバシーポリシー同意

#### 必要な操作
| 操作種別 | 操作内容 | 必要な入力 | 期待される出力 |
|---------|---------|-----------|---------------|
| 作成 | 新規ユーザー登録 | メール、パスワード、ユーザータイプ | アカウント作成完了 |
| 送信 | 認証メール送信 | メールアドレス | 認証リンク付きメール |

#### 処理フロー
1. ユーザータイプを選択
2. 基本情報（メール、パスワード）を入力
3. 利用規約に同意
4. 認証メールを送信
5. メール内のリンクをクリックして認証完了
6. ログイン画面へ遷移

#### データ構造（概念）
```yaml
User:
  識別子: ユーザーID（UUID）
  基本情報:
    - メールアドレス（必須）
    - パスワード（ハッシュ化、必須）
    - ユーザータイプ（必須）
    - 氏名（任意）
  メタ情報:
    - 登録日時
    - 最終ログイン日時
    - メール認証状態
  関連:
    - Firm/Company/SupportOrg（ユーザータイプにより異なる）
```

### 3.3 D-001: ダッシュボード（ユーザータイプ別）

#### 目的
ユーザータイプごとに最適化された情報とアクションを提供する。

#### 主要機能
- **外国人**: 在留期限、申請進捗、アラート
- **企業**: 従業員ビザ状況、期限管理、一括操作
- **登録支援機関**: 支援対象者一覧、面談予定、報告書締切
- **行政書士**: 案件一覧、署名待ち、収益サマリー

#### 必要な操作
| 操作種別 | 操作内容 | 必要な入力 | 期待される出力 |
|---------|---------|-----------|---------------|
| 取得 | ダッシュボードデータ取得 | ユーザーID | ユーザータイプ別データ |
| 取得 | AI予測データ取得 | 申請ID | 承認予測、所要日数予測 |

#### 処理フロー
1. ログイン後、ダッシュボードを表示
2. ユーザータイプに応じたウィジェットを配置
3. AI予測データを非同期で取得
4. リアルタイム更新（WebSocket）

#### データ構造（概念）
```yaml
Dashboard:
  識別子: ユーザーID
  基本情報:
    - ウィジェット配置（ユーザータイプ別）
    - 表示設定（カスタマイズ可能）
  メタ情報:
    - 最終アクセス日時
  関連:
    - Application（1対多）
    - Alert（1対多）
```

### 3.4 A-001: 在留資格申請作成ページ

#### 目的
29種類の在留資格申請を、AI支援により簡単かつ正確に作成する。

#### 主要機能
- 在留資格タイプ選択（29種類）
- AI申請書類最適化（GPT-4）
- AI理由書生成（Claude 3.5）
- 書類アップロード・自動保存
- 入力内容のリアルタイムバリデーション
- 多言語対応フォーム

#### 必要な操作
| 操作種別 | 操作内容 | 必要な入力 | 期待される出力 |
|---------|---------|-----------|---------------|
| 作成 | 新規申請作成 | 在留資格タイプ、基本情報 | 申請ドラフト |
| 実行 | AI書類最適化 | 申請ドラフト | 最適化された申請書 |
| 実行 | AI理由書生成 | 申請背景情報 | 理由書テキスト |
| 作成 | 書類アップロード | ファイル（PDF/画像） | アップロード完了 |

#### 処理フロー
1. 在留資格タイプを選択
2. 必要情報を入力（自動保存）
3. AIボタンをクリックして書類最適化
4. 生成された理由書を確認・編集
5. 必要書類をアップロード
6. 行政書士に確認依頼（または自己申請）

#### データ構造（概念）
```yaml
Application:
  識別子: 申請ID（UUID）
  基本情報:
    - 在留資格タイプ（必須）
    - 申請者情報（必須）
    - 雇用主情報（任意）
    - 申請理由（必須）
  AI生成データ:
    - AI最適化フラグ
    - AI承認予測スコア（0-100%）
    - AI予測所要日数
  メタ情報:
    - 作成日時
    - 更新日時
    - ステータス（下書き/提出済み/審査中/承認/不許可）
  関連:
    - User（申請者）
    - Firm（行政書士事務所、任意）
    - Document（1対多）
```

### 3.5 DOC-001: 書類管理ページ

#### 目的
全ての申請関連書類を一元管理し、必要なときにすぐアクセスできる。

#### 主要機能
- 書類一覧表示（申請別、カテゴリ別）
- PDFダウンロード
- 書類プレビュー
- 検索・フィルタリング
- 書類の再利用（テンプレート化）

#### 必要な操作
| 操作種別 | 操作内容 | 必要な入力 | 期待される出力 |
|---------|---------|-----------|---------------|
| 取得 | 書類一覧取得 | ユーザーID、フィルタ条件 | 書類リスト |
| 取得 | 書類ダウンロード | 書類ID | PDFファイル |
| 削除 | 書類削除 | 書類ID | 削除完了 |

#### 処理フロー
1. 書類一覧を表示
2. フィルタ・検索で絞り込み
3. 書類をプレビュー
4. 必要に応じてダウンロード

#### データ構造（概念）
```yaml
Document:
  識別子: 書類ID（UUID）
  基本情報:
    - 書類名（必須）
    - 書類タイプ（必須）
    - ファイルURL（S3/GCS、必須）
    - ファイルサイズ（必須）
  メタ情報:
    - アップロード日時
    - 最終アクセス日時
  関連:
    - Application（申請、任意）
    - User（アップロード者）
```

### 3.6 ADMIN-001: 管理者ダッシュボード

#### 目的
システム全体の状況を監視し、必要な管理操作を実行する。

#### 主要機能
- 全ユーザー/テナント一覧
- 利用統計（ユーザー数、申請数、収益）
- システムログ閲覧
- 法令アップデート管理
- RBAC設定

#### 必要な操作
| 操作種別 | 操作内容 | 必要な入力 | 期待される出力 |
|---------|---------|-----------|---------------|
| 取得 | 全体統計取得 | 期間指定 | 統計データ |
| 更新 | ユーザー権限変更 | ユーザーID、新ロール | 更新完了 |
| 取得 | 監査ログ閲覧 | フィルタ条件 | ログエントリ一覧 |

#### 処理フロー
1. 管理者ダッシュボードにアクセス
2. 全体統計を確認
3. 必要に応じてユーザー管理、システム設定を実施
4. 監査ログで操作履歴を確認

#### データ構造（概念）
```yaml
SystemStats:
  識別子: 日付
  基本情報:
    - 総ユーザー数
    - 総申請数
    - 総収益
    - アクティブユーザー数
  メタ情報:
    - 集計日時
  関連:
    - User（多対多）
    - Application（多対多）
```

---

## 4. データ設計概要

### 4.1 主要エンティティ

```yaml
User:
  概要: システムユーザー（外国人、企業、支援機関、行政書士、管理者）
  主要属性:
    - 基本情報: ID、メール、パスワード、氏名、ユーザータイプ
    - 認証情報: メール認証状態、二要素認証設定
    - メタ情報: 登録日時、最終ログイン日時
  関連:
    - Firm（多対1、行政書士の場合）
    - Company（多対1、企業ユーザーの場合）
    - SupportOrg（多対1、支援機関の場合）
    - Application（1対多、申請）

Firm:
  概要: 行政書士事務所
  主要属性:
    - 基本情報: 事務所名、代表者、所在地、電話番号
    - 業務情報: 登録番号、取扱案件数、従量課金設定
  関連:
    - User（1対多、所属行政書士）
    - Application（1対多、担当案件）

Company:
  概要: 雇用企業
  主要属性:
    - 基本情報: 企業名、代表者、所在地、業種
    - 雇用情報: 外国人従業員数、契約中の支援機関
  関連:
    - User（1対多、企業ユーザー）
    - Applicant（1対多、雇用外国人）

SupportOrg:
  概要: 登録支援機関
  主要属性:
    - 基本情報: 機関名、代表者、登録番号、所在地
    - 支援情報: 支援対象者数、対応言語
  関連:
    - User（1対多、支援機関スタッフ）
    - Applicant（1対多、支援対象外国人）

Applicant:
  概要: 外国人本人（在留資格申請者）
  主要属性:
    - 基本情報: 氏名、国籍、生年月日、性別
    - 在留情報: 在留資格、在留期限、在留カード番号
    - 職歴・学歴: 過去の勤務先、学歴、資格
  関連:
    - User（1対1、外国人ユーザー）
    - Company（多対1、現在の雇用主）
    - SupportOrg（多対1、支援機関）
    - Application（1対多、申請履歴）

Application:
  概要: 在留資格申請案件
  主要属性:
    - 申請情報: 在留資格タイプ、申請種別、申請理由
    - AI予測: 承認予測スコア、予測所要日数、AI推奨事項
    - ステータス: 下書き/提出済み/審査中/承認/不許可
  関連:
    - Applicant（多対1、申請者）
    - Firm（多対1、担当行政書士事務所、任意）
    - Document（1対多、関連書類）
    - Timeline（1対多、進捗履歴）

Document:
  概要: 申請関連書類
  主要属性:
    - ファイル情報: 書類名、書類タイプ、ファイルURL、サイズ
    - AI処理: OCR結果、自動翻訳結果
  関連:
    - Application（多対1、申請）
    - User（多対1、アップロード者）

Timeline:
  概要: 申請進捗履歴
  主要属性:
    - イベント情報: イベントタイプ、タイムスタンプ、詳細
  関連:
    - Application（多対1、申請）

AuditLog:
  概要: 監査ログ
  主要属性:
    - 操作情報: 操作種別、対象、IPアドレス、タイムスタンプ
  関連:
    - User（多対1、操作者）
```

### 4.2 エンティティ関係図
```
User ─┬─ Firm          (多対1)
      ├─ Company       (多対1)
      ├─ SupportOrg    (多対1)
      ├─ Application   (1対多)
      └─ AuditLog      (1対多)

Applicant ─┬─ User        (1対1)
           ├─ Company     (多対1)
           ├─ SupportOrg  (多対1)
           └─ Application (1対多)

Application ─┬─ Applicant (多対1)
             ├─ Firm      (多対1、任意)
             ├─ Document  (1対多)
             └─ Timeline  (1対多)
```

### 4.3 バリデーションルール
```yaml
メールアドレス:
  - ルール: 有効なメール形式、重複不可
  - 理由: ユーザー識別とアカウント保護のため

パスワード:
  - ルール: 8文字以上、英数字混在
  - 理由: セキュリティ確保のため

在留カード番号:
  - ルール: 12桁の数字
  - 理由: 入管庁の規定に準拠

在留期限:
  - ルール: 未来の日付
  - 理由: 過去の日付は無効

ファイルサイズ:
  - ルール: 10MB以下
  - 理由: サーバー負荷とストレージコスト削減

ファイル形式:
  - ルール: PDF、JPEG、PNG のみ
  - 理由: セキュリティとマルウェア防止
```

---

## 5. 制約事項

### 外部API制限
- **入管庁API**: 1日10,000リクエスト制限（想定）
- **OpenAI GPT-4 API**: 従量課金（$0.01/1K tokens入力、$0.03/1K tokens出力）
- **Anthropic Claude 3.5 API**: 従量課金（$0.003/1K tokens入力、$0.015/1K tokens出力）
- **OpenAI Whisper API**: 従量課金（$0.006/分）
- **Pinecone**: 無料枠（100K vectors）、有料プラン$70/月～

### 技術的制約
- **ファイルサイズ制限**: 10MB/ファイル
- **同時接続数**: 1,000ユーザー（初期）
- **データベース接続**: 最大100接続（PostgreSQL）
- **セッションタイムアウト**: 30分（無操作時）
- **APIレート制限**: 100リクエスト/分/ユーザー

---

## 5.1 セキュリティ要件

### 基本方針
本プロジェクトは **CVSS 3.1（Common Vulnerability Scoring System）** に準拠したセキュリティ要件を満たすこと。

CVSS 3.1の評価観点:
- **機密性（Confidentiality）**: 不正アクセス防止、データ暗号化
- **完全性（Integrity）**: データ改ざん防止、入力検証
- **可用性（Availability）**: DoS対策、冗長化

---

### プロジェクト固有の必須要件

**認証機能（必須）**:
- ✅ ブルートフォース攻撃対策（5回失敗でアカウントロック、30分後解除）
- ✅ パスワードポリシー（8文字以上、英数字混在）
- ✅ セッション管理（30分タイムアウト、CSRF対策）
- ✅ 二要素認証（行政書士、管理者は必須）

**決済機能（必須）**:
- ✅ PCI DSS準拠（Stripe利用）
- ✅ トランザクションログ記録

**ファイルアップロード機能（必須）**:
- ✅ ファイルタイプ検証（PDF、JPEG、PNGのみ）
- ✅ ファイルサイズ制限（10MB）
- ✅ マルウェアスキャン（本番環境、ClamAV）

**その他の一般要件**:
- ✅ HTTPSの強制（本番環境）
- ✅ セキュリティヘッダー設定（CSP、HSTS、X-Frame-Options）
- ✅ 入力値のサニタイゼーション（XSS対策）
- ✅ エラーメッセージでの情報漏洩防止

---

### 運用要件：可用性とヘルスチェック

**ヘルスチェックエンドポイント（全プロジェクト必須）**:
- エンドポイント: `/api/health`
- 目的: Vercel/Cloud Runでのliveness/readinessプローブ
- 要件: データベース接続確認、5秒以内の応答

**グレースフルシャットダウン（全プロジェクト必須）**:
- SIGTERMシグナルハンドラーの実装
- 進行中のリクエスト完了まで待機
- タイムアウト: 8秒（Cloud Runの10秒制限に対応）

---

## 6. 複合API処理（バックエンド内部処理）

### 複合処理-001: AI申請書類最適化処理

**トリガー**: 「AIで最適化」ボタンクリック
**フロントエンドAPI**: POST /api/application/optimize
**バックエンド内部処理**:
1. 申請内容をGPT-4に送信し、最適化提案を取得
2. 過去の承認事例をVector DBで検索（類似度80%以上）
3. 承認予測モデルでスコアを算出
4. 最適化結果をデータベースに保存
**結果**: 最適化された申請書、AI予測スコア、類似事例
**外部サービス依存**: OpenAI GPT-4 API、Pinecone Vector DB

### 複合処理-002: AI理由書生成処理

**トリガー**: 「理由書を自動生成」ボタンクリック
**フロントエンドAPI**: POST /api/application/generate-reason
**バックエンド内部処理**:
1. 申請者の背景情報（職歴、学歴、申請理由）を収集
2. Claude 3.5 APIに送信し、理由書テキストを生成
3. 生成された理由書をデータベースに保存
4. 行政書士に確認依頼通知を送信
**結果**: 生成された理由書テキスト
**外部サービス依存**: Anthropic Claude 3.5 API

### 複合処理-003: 定期面談AI書き起こし処理

**トリガー**: 定期面談終了後、「書き起こし」ボタンクリック
**フロントエンドAPI**: POST /api/interview/transcribe
**バックエンド内部処理**:
1. 録画ファイル（音声）をWhisper APIに送信
2. 文字起こしテキストを取得
3. GPT-4で要約と重要ポイント抽出
4. 様式第5-5号（定期面談報告書）を自動生成
5. 報告書をPDF化してストレージに保存
**結果**: 書き起こしテキスト、要約、報告書PDF
**外部サービス依存**: OpenAI Whisper API、OpenAI GPT-4 API

### 複合処理-004: 入管API申請データ送信処理

**トリガー**: 「申請を提出」ボタンクリック
**フロントエンドAPI**: POST /api/application/submit
**バックエンド内部処理**:
1. 申請データを入管庁APIフォーマットに変換
2. 行政書士の電子署名を付与
3. 入管庁APIに申請データを送信
4. 申請受理番号を取得
5. 申請ステータスを「提出済み」に更新
6. 申請者と行政書士に通知メールを送信
**結果**: 申請受理完了、受理番号
**外部サービス依存**: 入管庁API、電子署名サービス

---

## 7. 技術スタック

### フロントエンド
```yaml
フレームワーク: Next.js 15 App Router
ランタイム: React 19
言語: TypeScript 5.7+
スタイリング: Tailwind CSS 3.4+
UIコンポーネント: Shadcn/ui (Radix UI)
状態管理: Zustand 5.0+
フォーム: React Hook Form 7.53+
バリデーション: Zod 3.23+
国際化: next-intl 3.22+
ビルドツール: Vite 5（開発）、Turbopack（本番）
```

### バックエンド
```yaml
API: tRPC 11.0+
ORM: Prisma 6.0+
認証: NextAuth.js v5
バリデーション: Zod 3.23+
キャッシュ: Redis 7.2+（Upstash）
ジョブキュー: BullMQ 5.0+
```

### AI/ML
```yaml
LLM:
  - OpenAI GPT-4 Turbo: 申請書類最適化
  - Anthropic Claude 3.5 Sonnet: 理由書生成
  - OpenAI Whisper API: 音声書き起こし
Vector DB: Pinecone / Weaviate
Embeddings: OpenAI text-embedding-3-large
```

### データベース
```yaml
プライマリDB: PostgreSQL 16（Neon推奨）
キャッシュ: Redis 7.2（Upstash）
Vector DB: Pinecone / Weaviate
ストレージ: AWS S3 / Google Cloud Storage
```

### インフラ
```yaml
ホスティング:
  - フロントエンド: Vercel
  - バックエンド: Vercel Serverless Functions / AWS Lambda
  - CDN: Cloudflare

監視:
  - エラー追跡: Sentry
  - APM: Datadog / New Relic
  - 稼働監視: Pingdom
```

### 開発ツール
```yaml
バージョン管理: Git + GitHub
CI/CD: GitHub Actions
コード品質: ESLint、Prettier、TypeScript
テスト: Vitest、Playwright
デザイン: Figma
```

---

## 8. 必要な外部サービス・アカウント

### 必須サービス
| サービス名 | 用途 | 取得先 | 月額コスト概算 |
|-----------|------|--------|--------------|
| Vercel Pro | フロントエンドホスティング | https://vercel.com | $20 |
| Neon | PostgreSQL 16 | https://neon.tech | $25 |
| Upstash Redis | セッション管理・キャッシュ | https://upstash.com | $10 |
| OpenAI API | GPT-4 Turbo、Whisper | https://platform.openai.com | 従量課金 |
| Anthropic API | Claude 3.5 Sonnet | https://console.anthropic.com | 従量課金 |
| Pinecone | Vector DB | https://www.pinecone.io | $70 |
| Sentry | エラートラッキング | https://sentry.io | $26 |
| Cloudflare Pro | CDN、WAF | https://www.cloudflare.com | $20 |
| Stripe | 決済処理 | https://stripe.com | 従量課金 |
| GitHub Team | コード管理 | https://github.com | $4/user |

### オプションサービス
| サービス名 | 用途 | 取得先 | 備考 |
|-----------|------|--------|------|
| Datadog | APM監視 | https://www.datadoghq.com | $15/月、本番環境推奨 |
| AWS S3 | ファイルストレージ | https://aws.amazon.com | 従量課金 |
| Figma Professional | デザイン | https://www.figma.com | $12/user/月 |

**Month 1概算コスト**: 約$200 + AI従量課金（GPT-4、Claude、Whisper）

---

## 9. 今後の拡張予定

**原則**: 拡張予定があっても、必要最小限の実装のみを行う

- 「あったらいいな」は実装しない
- 拡張可能性のための余分な要素は追加しない
- 将来の「もしかして」のための準備は禁止
- 今、ここで必要な最小限の要素のみを実装

拡張が必要になった時点で、追加実装を行います。

### 将来的な拡張候補（実装はしない）
- モバイルアプリ（Flutter）
- 在留資格変更シミュレーション
- 企業向けHR連携（給与計算システム等）
- 行政書士向けAI契約書レビュー
- 多言語翻訳の精度向上（専門用語辞書）

---

## 10. 開発スケジュール（4ヶ月）

### Month 1: 基盤構築
- Week 1-2: インフラ・認証基盤（Next.js 15、Prisma、NextAuth.js v5、PostgreSQL、Redis、Vercel）
- Week 3-4: データベース設計・デザインシステム（Prisma Schema、Row Level Security、Shadcn/ui、AI API統合）

### Month 2: コア機能実装
- Week 5-6: 外国人・企業向け機能（在留カード管理、29在留資格申請、多言語対応、従業員DB、AI期限アラート）
- Week 7-8: 登録支援機関・行政書士向け機能（支援計画書、定期面談、AI書き起こし、顧客管理、87申請類型、案件進捗管理）

### Month 3: AI・API統合
- Week 9-10: AI差別化機能（GPT-4申請書最適化、Claude理由書生成、承認予測モデル、Vector DB類似事例検索、報告書自動生成、電子署名）
- Week 11-12: 入管API完全統合・管理者機能（マイナポータルAPI連携、申請送信・進捗取得、GPASS連携、マイナンバーカード連携、マルチレベル管理、RBAC、監査ログ）

### Month 4: テスト・ローンチ
- Week 13-14: 品質保証（E2Eテスト、パフォーマンステスト、セキュリティ監査、負荷テスト）
- Week 15: パイロット運用（行政書士事務所での実案件テスト、フィードバック収集・修正）
- Week 16: 正式ローンチ（本番デプロイ、監視システム稼働、決済統合、一般公開）

---

**要件定義書作成日**: 2026年1月16日
**最終更新日**: 2026年1月16日
**バージョン**: v2.0（BlueLamp標準フォーマット、4ヶ月フルローンチ版）
